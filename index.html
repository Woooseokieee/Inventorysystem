<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced Grocery Inventory</title>

<style>
body { font-family: Arial; background:#f4f4f4; padding:20px; }
h2 { text-align:center; }
.box { background:#fff; padding:15px; margin-bottom:20px; border-radius:5px; }
input, button { padding:8px; margin:5px; }
table { width:100%; border-collapse:collapse; background:#fff; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#eee; }
.out { color:red; font-weight:bold; }
</style>
</head>

<body>

<h2>Advanced Grocery Inventory System</h2>

<div class="box">
  <input id="search" placeholder="Search product..." onkeyup="searchProduct()">
</div>

<div class="box">
  <input id="name" placeholder="Product name">
  <input id="price" type="number" placeholder="Price">
  <input id="stock" type="number" placeholder="Stock">
  <input id="expiry" type="date">
  <button onclick="addProduct()">Add Product</button>
</div>

<table>
<thead>
<tr>
  <th>Name</th>
  <th>Price</th>
  <th>Stock</th>
  <th>Expiry</th>
  <th>Actions</th>
</tr>
</thead>
<tbody id="productTable"></tbody>
</table>

<h3>ðŸ“œ History</h3>
<div class="box">
  <ul id="history"></ul>
</div>

<script>
const API = "https://grocery-inventory-backend-gvx2.onrender.com/products";
const HISTORY_API = "https://YOUR-BACKEND.onrender.com/history";

let products = [];

// LOAD PRODUCTS
function loadProducts() {
  fetch(API)
    .then(res => res.json())
    .then(data => {
      products = data;
      displayProducts(data);
    });
}

// DISPLAY PRODUCTS
function displayProducts(list) {
  const tbody = document.getElementById("productTable");
  tbody.innerHTML = "";

  list.forEach(p => {
    tbody.innerHTML += `
      <tr>
        <td>${p.name}</td>
        <td>${p.price}</td>
        <td>${p.stock == 0 ? "<span class='out'>OUT OF STOCK</span>" : p.stock}</td>
        <td>${p.expiry || "-"}</td>
        <td>
          <button onclick="changeStock(${p.id}, ${p.stock}, 1, '${p.name}')">+</button>
          <button onclick="changeStock(${p.id}, ${p.stock}, -1, '${p.name}')">âˆ’</button>
          <button onclick="removeProduct(${p.id}, '${p.name}')">Remove</button>
        </td>
      </tr>
    `;
  });
}

// ADD PRODUCT
function addProduct() {
  const name = document.getElementById("name").value.trim();
  const price = document.getElementById("price").value;
  const stock = document.getElementById("stock").value;
  const expiry = document.getElementById("expiry").value;

  if (!name) return alert("Product name required");

  fetch(API, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ name, price, stock, expiry })
  }).then(() => {
    loadProducts();
    loadHistory();
  });
}

// CHANGE STOCK
function changeStock(id, current, change, name) {
  const newStock = current + change;
  if (newStock < 0) return;

  fetch(`${API}/${id}`, {
    method:"PUT",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      stock:newStock,
      action: change > 0 ? "Added stock" : "Subtracted stock",
      quantity: Math.abs(change),
      name:name
    })
  }).then(() => {
    loadProducts();
    loadHistory();
  });
}

// REMOVE PRODUCT
function removeProduct(id, name) {
  if (!confirm("Remove product?")) return;

  fetch(`${API}/${id}`, {
    method:"DELETE",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ name })
  }).then(() => {
    loadProducts();
    loadHistory();
  });
}

// SEARCH
function searchProduct() {
  const q = document.getElementById("search").value.toLowerCase();
  displayProducts(products.filter(p => p.name.toLowerCase().includes(q)));
}

// LOAD HISTORY
function loadHistory() {
  fetch(HISTORY_API)
    .then(res => res.json())
    .then(data => {
      const ul = document.getElementById("history");
      ul.innerHTML = "";
      data.forEach(h => {
        ul.innerHTML += `<li>${h.date} â€” ${h.product}: ${h.action} (${h.quantity})</li>`;
      });
    });
}

loadProducts();
loadHistory();
</script>

</body>
</html>
